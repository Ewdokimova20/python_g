import{d as j,s as x,r as f,w as B,o as c,a as y,b as m,e as l,u as a,f as u,g as $,t as k,N as P,c as h,h as C,i as N,F as w,j as I,k as U,l as G,m as L,n as q,p as z,_ as H}from"./index-B9ncFhZ9.js";const J=j({__name:"SignalCounter",props:{bis:{},station:{},nka:{}},setup(v){const n=v,r=x({url:"/packet_counters/signals_message",params:{station:n.station,bis:n.bis,nka:n.nka},updateRate:2e3}),d=f();return B(()=>r.data,(_,i)=>{i&&Object.values(i).length!==0&&(d.value=Object.entries(r.data).map(([p,s])=>Object.entries(s).reduce((t,[e,{c:o}])=>({...t,signal:Number(p),[e]:o}),{})))}),(_,i)=>(c(),y(a(I),{value:d.value,"responsive-layout":"scroll",class:"signal-counter p-datatable-sm w-full"},{default:m(()=>[l(a(u),{"header-style":"width: 3rem"}),l(a(u),{field:"signal",header:"Тип сигнала","body-style":"width: 10.7vw; padding-left: 4rem;"},{body:m(p=>[$(k(a(P)[p.data.signal]),1)]),_:1}),(c(!0),h(w,null,C(a(N),(p,s)=>(c(),y(a(u),{key:s,field:String(s),header:p},null,8,["field","header"]))),128))]),_:1},8,["value"]))}}),K=j({__name:"NkaCounter",props:{bis:{},station:{}},setup(v){const n=U(),r=v,d=f([]),_=x({url:"/packet_counters/nka_message",params:{station:r.station,bis:r.bis},updateRate:2e3}),i=f();return B(()=>_.data,(p,s)=>{if(s){if(Object.values(s).length!==0){const t=d.value?d.value.map(e=>e.nka):[];i.value=Object.entries(_.data).reduce((e,[o,S])=>{const b=Object.entries(S).reduce((O,[R,{c:g}])=>({...O,[R]:g}),{});return e.push({nka:+o,...b}),e},[]),d.value=i.value.filter(e=>t.includes(e.nka))}}else i.value=[]}),(p,s)=>(c(),y(a(I),{"expanded-rows":d.value,"onUpdate:expandedRows":s[0]||(s[0]=t=>d.value=t),value:i.value,"responsive-layout":"scroll",class:"nka-counter p-datatable-sm"},{expansion:m(t=>[l(J,{nka:t.data.nka,bis:r.bis,station:r.station,style:{"margin-top":"-0.5rem","margin-bottom":"-0.5rem"}},null,8,["nka","bis","station"])]),default:m(()=>[l(a(u),{expander:!0,"header-style":"width: 3rem;","body-style":"padding-left: 2rem;"}),l(a(u),{field:"nka",header:"НКА","body-style":"width: 10vw;"},{body:m(t=>[$(" НКА "+k(t.data.nka)+" ("+k(a(n).sysNumToNkuNum(t.data.nka))+") ",1)]),_:1}),(c(!0),h(w,null,C(a(N),(t,e)=>(c(),y(a(u),{key:e,field:String(e),header:t},null,8,["field","header"]))),128))]),_:1},8,["expanded-rows","value"]))}}),Q={class:"flex flex-wrap justify-content-end",style:{gap:"0.5rem"}},W=j({__name:"PacketCountersTable",setup(v){const n=f([]),r=x({url:"/packet_counters/packet_type",updateRate:2e3,startImmediately:!0}),d=x({url:"/packet_counters",updateRate:2e3,startImmediately:!0}),_=f();B(()=>r.data,(p,s)=>{if(s&&Object.values(s).length!==0){const t=n.value?n.value.map(e=>e.id):[];_.value=Object.entries(r.data).reduce((e,[o,S])=>(Object.entries(S).forEach(([b,O])=>{var V,T,A;const R=Object.entries(O).reduce((E,[F,{c:M}])=>({...E,[F]:M}),{}),g=(A=(T=(V=d.data)==null?void 0:V[+o])==null?void 0:T[+b])==null?void 0:A.t,D={bis:+b,station:+o,latestAt:g&&z(g),id:`${o}_${b}`,...R};e.push(D)}),e),[]),n.value=_.value.filter(e=>t.includes(e.id))}});const i=()=>{n.value=[]};return(p,s)=>{var t;return c(),h(w,null,[l(a(I),{"expanded-rows":n.value,"onUpdate:expandedRows":s[0]||(s[0]=e=>n.value=e),value:_.value,"responsive-layout":"scroll",class:"p-datatable-sm"},{header:m(()=>[G("div",Q,[l(a(L),{class:"p-button-text p-button-secondary",icon:"pi pi-minus",label:"Свернуть все",onClick:i})])]),expansion:m(e=>[l(K,{bis:e.data.bis,station:e.data.station,style:{margin:"-0.5rem -0.5rem"}},null,8,["bis","station"])]),default:m(()=>[l(a(u),{expander:!0,"header-style":"width: 3rem"}),l(a(u),{field:"bis",header:"Станция/Бис","body-style":"width: 11.8vw;"},{body:m(e=>[$(k(e.data.station)+"/"+k(e.data.bis),1)]),_:1}),(c(!0),h(w,null,C(a(N),(e,o)=>(c(),y(a(u),{key:o,field:String(o),header:e},null,8,["field","header"]))),128)),l(a(u),{field:"latestAt",header:"Обновлено"})]),_:1},8,["expanded-rows","value"]),l(q,{timestamp:(t=a(r))==null?void 0:t.lastGet},null,8,["timestamp"])],64)}}}),X=H(W,[["__scopeId","data-v-d1003496"]]),Z=j({__name:"PacketExchange",setup(v){return(n,r)=>(c(),h("div",null,[l(X)]))}});export{Z as default};
