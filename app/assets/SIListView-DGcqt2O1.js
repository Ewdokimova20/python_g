import{d as U,an as K,o as u,a as S,b as l,e as p,u as a,f as k,r as I,cU as B,M as D,c as v,az as Q,au as d,g as h,l as A,m as V,F as J,h as j,t as g,cV as q,p as y,j as z,S as P,ax as Y}from"./index-B9ncFhZ9.js";import{_ as G}from"./OpenNewTabButton.vue_vue_type_script_setup_true_lang-N3oNufr4.js";import{F as H,u as W,_ as X,a as Z}from"./useLoadSIPhrases-B62SkcB8.js";import"./setItemToLS-BDlwVMSR.js";const ee=U({__name:"PhrasesList",props:{si:{}},setup(C){const o=C;K(H,o.si.siForm);const f={recId:o.si.id,vitok:o.si.vitok,nkuNum:o.si.nkuNum,form:o.si.siForm},{phrases:c,isLoading:_,phraseError:N}=W(f);return(w,r)=>(u(),S(X,{style:{height:"40rem"},data:a(c)??[],error:a(N),"is-loading":a(_)},{columns:l(()=>[p(a(k),null,{body:l(x=>[p(G,{label:"Просмотреть","component-name":"SISingleView",params:{selected:JSON.stringify(x.data),params:JSON.stringify(f),si:JSON.stringify(o.si)},class:"p-button-sm p-button-outlined p-button-secondary p-1"},null,8,["params"])]),_:1})]),_:1},8,["data","error","is-loading"]))}}),ae={class:"p-component"},se={class:"flex flex-wrap justify-content-end",style:{gap:"0.5rem"}},te={key:0},le={key:1},re={class:"p-error text-xs"},ie={key:1},me=U({__name:"SIListView",setup(C){const o=I(!1),f=I([]),c=Z(),{siList:_,isSILoading:N,siError:w}=B(c),r=_,x=async(b,s,e)=>{var i;const t=r.value.findIndex(n=>n.id===e);r.value[t].p4={},r.value[t].p4.data=null,r.value[t].p4.isLoading=!0,r.value[t].p4.error="";try{const n=await Y.get("/check_p4",{params:{form:s,nka:b,recId:e}});r.value[t].p4.data=n.data}catch(n){const m=n;r.value[t].p4.error="Возникла ошибка при проверке",((i=m.response)==null?void 0:i.status)===404&&(r.value[t].p4.error="Кадр с признаком Р4 для данной СИ не найден")}finally{r.value[t].p4.isLoading=!1}};async function $(b){o.value=!1,c.clearStore(),await c.loadSI(b),o.value=!0}const E=[{field:"timestamp",header:"Дата",sortable:!0,handler:y},{field:"nkuNum",header:"НКА",sortable:!0},{field:"siForm",header:"Номер формы",sortable:!0},{field:"siFormat",header:"Формат СИ"},{field:"flagCdb",header:"Квит. записи в ЦБД"},{field:"flagSui",header:"Квит. передачи на СУИ"},{field:"flagKa",header:"Квит. закладки на КА"},{field:"writeTimeCdb",header:"Время записи в ЦБД",handler:y},{field:"writeTimeSui",header:"Время передачи на СУИ",handler:y},{field:"writeTimeKa",header:"Время закладки на КА",handler:y}],F=I({nkuNum:{value:null,matchMode:d.CONTAINS},timestamp:{value:null,matchMode:d.CONTAINS},siForm:{value:null,matchMode:d.CONTAINS},siFormat:{value:null,matchMode:d.CONTAINS},flagCdb:{value:null,matchMode:d.EQUALS},flagSui:{value:null,matchMode:d.EQUALS},flagKa:{value:null,matchMode:d.EQUALS},writeTimeCdb:{value:null,matchMode:d.CONTAINS},writeTimeSui:{value:null,matchMode:d.CONTAINS},writeTimeKa:{value:null,matchMode:d.CONTAINS}}),R=()=>{f.value=void 0};return D(()=>c.clearStore()),(b,s)=>(u(),v("div",ae,[p(Q,{"is-with-bis":!1,"is-with-form":!0,"loading-state":a(N),"nka-mode":"multiple",onQueryParams:$},null,8,["loading-state"]),a(_).length&&o.value?(u(),S(a(z),{key:0,filters:F.value,"onUpdate:filters":s[0]||(s[0]=e=>F.value=e),expandedRows:f.value,"onUpdate:expandedRows":s[1]||(s[1]=e=>f.value=e),value:a(r),class:"p-datatable-sm","responsive-layout":"scroll",paginator:"",rows:20,"rows-per-page-options":[20,50],"filter-display":"row"},{empty:l(()=>s[2]||(s[2]=[h(" Ничего не найдено ")])),header:l(()=>[A("div",se,[p(a(V),{class:"p-button-text p-button-secondary",icon:"pi pi-minus",label:"Свернуть все",onClick:R})])]),expansion:l(e=>[p(ee,{si:e.data},null,8,["si"])]),default:l(()=>[p(a(k),{expander:!0,"header-style":"width: 3rem"}),(u(),v(J,null,j(E,(e,t)=>p(a(k),{key:t,field:e.field||void 0,header:e.header||"",sortable:e.sortable||!1,"show-filter-menu":!1},{body:l(({data:i})=>[h(g(e.handler?e.handler(i[e.field]):i[e.field]),1)]),loading:l(()=>s[3]||(s[3]=[h(" Загрузка... ")])),filter:l(({filterModel:i,filterCallback:n})=>[p(a(q),{modelValue:i.value,"onUpdate:modelValue":m=>i.value=m,type:"text",class:"p-column-filter",placeholder:"Поиск",onInput:m=>n()},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["field","header","sortable"])),64)),p(a(k),{header:"Проверить кадр с Р4",field:"p4"},{body:l(({data:e})=>{var t,i,n,m,L,T,M,O;return[e.siForm===169||e.siForm===893?(u(),v("div",te,[(t=e.p4)!=null&&t.data?(u(),v("span",le,"tk = "+g((L=(m=e.p4)==null?void 0:m.data)==null?void 0:L.tk)+" ("+g(a(y)((M=(T=e.p4)==null?void 0:T.data)==null?void 0:M.timestamp))+")",1)):(u(),S(a(V),{key:0,icon:((i=e.p4)==null?void 0:i.error)===!0?"pi pi-sync":"pi pi-search",label:"P4",loading:((n=e.p4)==null?void 0:n.isLoading)??!1,onClick:oe=>x(e.nkuNum,e.siForm,e.id)},null,8,["icon","loading","onClick"])),A("div",re,g((O=e.p4)==null?void 0:O.error),1)])):(u(),v("div",ie,"Признак P4 формируется только при закладке ЭИ и ЧВП"))]}),default:l(()=>[s[4]||(s[4]=h(" >"))]),_:1})]),_:1},8,["filters","expandedRows","value"])):a(w)?(u(),S(a(P),{key:1,severity:"error",closable:!1},{default:l(()=>[h(g(a(w)),1)]),_:1})):(u(),S(a(P),{key:2,severity:"info",closable:!1},{default:l(()=>s[5]||(s[5]=[h("Нет данных для отображения")])),_:1}))]))}});export{me as default};
