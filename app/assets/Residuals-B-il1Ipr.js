import{J as gt,W as Ut,s as yt,w as Xt,B as O,X as jt,Y as Ht,o as w,c as P,Z as Zt,d as Z,k as bt,P as qt,$ as Jt,u as A,l as N,F as $,h as X,L as Qt,O as ea,a0 as ta,g as Pe,t as G,K as St,y as _t,a1 as aa,_ as he,v as ae,a2 as ra,a3 as Ge,r as de,e as V,a as J,b as K,I as na,n as At,a4 as ia,M as sa,q as oa,Q as ge,R as la,S as $e}from"./index-B9ncFhZ9.js";import{_ as kt}from"./BisSelectMenu.vue_vue_type_script_setup_true_lang-D_52kiR4.js";import{u as Lt}from"./useSelectedBisState-BJ3N0Krx.js";import{R as Re,r as q,S as Te,i as ua,a as ca,_ as B,c as Dt,e as U,b as wt,d as da,P as Ce,f as Ke,g as It,h as E,m as W,p as pa,t as xt,j as Q,u as j,s as ha,l as fa,k as We,G as Ve,n as ee,C as va,o as H,q as Oe,v as Pt,w as ma,x as ga,y as Nt,z as ya,A as ba,B as Sa,D as Y,E as _a,F as Aa,L as ka,H as La,I as Mt,J as Ye,K as Da,M as wa,N as Ia,O as Rt,Q as Tt,T as xa,U as Pa,V as Ue,W as Ct,X as Na,Y as Ma,Z as Ra,$ as Ee,a0 as Ta,a1 as Ca,a2 as Vt,a3 as Xe,a4 as je,a5 as Va,a6 as Oa,a7 as Ea,a8 as Ba,a9 as za,aa as re,ab as ye,ac as Fa,ad as Ga,ae as $a,af as He,ag as Ze,ah as Ka,ai as Wa,aj as Ya,ak as Ua,al as Xa,am as ja,an as Ha,ao as Za,ap as qa}from"./tooltip-dMyvHWD1.js";import{u as Ja,a as Qa}from"./useSessionStorage-BONWqHvJ.js";import"./setItemToLS-BDlwVMSR.js";const fe=gt("residuals",()=>{const a=Ut(null),e=yt({url:"/residual_groups",startImmediately:!0,updateRate:5e3});Xt(()=>e.data,r=>{r&&(a.value=r)},{immediate:!0});const t=O(()=>{var r,n;if(e.error==null)return null;if((r=e.error)!=null&&r.response)switch((n=e.error)==null?void 0:n.response.status){case 404:return"Рассчитанные значения невязок отсутствуют";case 500:return"Произошла ошибка при расчете значений невязок";default:return"Неизвестная ошибка в серверной части СПО КНП"}return"Нет связи с серверной частью СПО КНП"});return{service:e,data:a,error:t}});var er=`
.p-skeleton {
    overflow: hidden;
}

.p-skeleton::after {
    content: '';
    animation: p-skeleton-animation 1.2s infinite;
    height: 100%;
    left: 0;
    position: absolute;
    right: 0;
    top: 0;
    transform: translateX(-100%);
    z-index: 1;
}

.p-skeleton.p-skeleton-circle {
    border-radius: 50%;
}

.p-skeleton-none::after {
    animation: none;
}

@keyframes p-skeleton-animation {
    from {
        transform: translateX(-100%);
    }
    to {
        transform: translateX(100%);
    }
}
`,tr={root:{position:"relative"}},ar={root:function(e){var t=e.props;return["p-skeleton p-component",{"p-skeleton-circle":t.shape==="circle","p-skeleton-none":t.animation==="none"}]}},rr=jt(er,{name:"skeleton",manual:!0}),nr=rr.load,ir={name:"BaseSkeleton",extends:Ht,props:{shape:{type:String,default:"rectangle"},size:{type:String,default:null},width:{type:String,default:"100%"},height:{type:String,default:"1rem"},borderRadius:{type:String,default:null},animation:{type:String,default:"wave"}},css:{classes:ar,inlineStyles:tr,loadStyle:nr},provide:function(){return{$parentInstance:this}}},Ot={name:"Skeleton",extends:ir,computed:{containerStyle:function(){return this.size?{width:this.size,height:this.size,borderRadius:this.borderRadius}:{width:this.width,height:this.height,borderRadius:this.borderRadius}}}};function sr(a,e,t,r,n,i){return w(),P("div",Zt({class:a.cx("root"),style:[a.sx("root"),i.containerStyle],"aria-hidden":"true"},a.ptm("root"),{"data-pc-name":"skeleton"}),null,16)}Ot.render=sr;const be={range:{residualKey:"delta",statusKey:"status",decimalPiecesNumber:1},speed:{residualKey:"speedResidual",statusKey:"statusSpeedResidual",decimalPiecesNumber:2}},or=a=>({residualKey:be[a].residualKey,statusKey:be[a].statusKey,decimalPiecesNumber:be[a].decimalPiecesNumber}),lr=(a,e)=>e==null?"grey":{green:a===!0,red:a===!1,grey:a===void 0||null},ur=(a,e)=>a==null?null:Math.abs(a)>99?a.toExponential(0):a.toFixed(e),Et=a=>a!=null?Object.keys(a).length===0:!0,cr=a=>Et(a)?null:a,dr={class:"text-xs"},pr={class:"text-xs"},hr=["onMouseover"],fr=Z({__name:"ResidualsTable",props:{mode:{},data:{},showData:{type:Function},hideData:{type:Function}},setup(a){const e=a,{residualKey:t,statusKey:r,decimalPiecesNumber:n}=or(e.mode),i=bt(),s=(l,u,c)=>{Et(c)||e.showData(l,{signalPair:u,residual:cr(c)})};return(l,u)=>{const c=qt("tooltip");return w(),P("table",dr,[Jt([A(i).sysNumList],()=>(w(),P("thead",null,[N("tr",null,[u[2]||(u[2]=N("th",null,"НКА",-1)),(w(!0),P($,null,X(A(i).sysNumList,o=>(w(),P("th",{key:o,class:"text-sm"},G(o),1))),128))])])),u,0),N("tbody",null,[(w(!0),P($,null,X(A(aa),o=>(w(),P("tr",{key:A(Qt)(o)},[ea((w(),P("td",pr,[Pe(G(A(St)(o)),1)])),[[c,A(ta)(o),void 0,{top:!0}]]),(w(!0),P($,null,X(A(i).sysNumList,d=>{var p,f,h,m,g,_,b,k,v;return w(),P("td",{key:d,class:_t(["cell",A(lr)((h=(f=(p=l.data)==null?void 0:p[o])==null?void 0:f[d])==null?void 0:h[A(r)],(_=(g=(m=l.data)==null?void 0:m[o])==null?void 0:g[d])==null?void 0:_[A(t)])]),onMouseover:y=>{var D,S;return s(y,o,(S=(D=l.data)==null?void 0:D[o])==null?void 0:S[d])},onMouseleave:u[1]||(u[1]=(...y)=>l.hideData&&l.hideData(...y))},[N("span",null,G(A(ur)((v=(k=(b=l.data)==null?void 0:b[o])==null?void 0:k[d])==null?void 0:v[A(t)],A(n))),1)],42,hr)}),128))]))),128))])])}}}),vr=he(fr,[["__scopeId","data-v-3a3b0336"]]),mr={class:"max-w-25rem"},gr={class:"text-sm"},yr={class:"font-bold"},br={key:0},Sr={class:"font-bold"},_r={key:1},Ar={class:"font-bold"},kr=Z({__name:"ResidualsTablePopup",props:{mode:{},data:{}},setup(a){const e=a,t=O(()=>e.mode==="range"?"м":"м/с");function r(o){return o!=null?`${o.toFixed(3)} ${t.value}`:null}const n=O(()=>{var o;return((o=e.data)==null?void 0:o.signalPair)!=null?ra[e.data.signalPair].tooltip:null}),i=O(()=>{var d;if(!((d=e.data)!=null&&d.residual))return null;const o=e.mode==="range"?e.data.residual.delta:e.data.residual.speedResidual;return r(o)}),s=O(()=>{var o;return((o=e.data)==null?void 0:o.residual)!=null?r(e.data.residual.delta1):null}),l=O(()=>{var o;return((o=e.data)==null?void 0:o.residual)!=null?r(e.data.residual.delta2):null}),u=O(()=>{var o,d;return((d=(o=e.data)==null?void 0:o.residual)==null?void 0:d.signal1)!=null?Ge(e.data.residual.signal1):null}),c=O(()=>{var o,d;return((d=(o=e.data)==null?void 0:o.residual)==null?void 0:d.signal2)!=null?Ge(e.data.residual.signal2):null});return(o,d)=>(w(),P("article",mr,[N("table",gr,[i.value?(w(),P($,{key:0},[d[0]||(d[0]=N("tr",null,[N("td",{class:"font-bold text-primary"},"Невязка по комбинации:")],-1)),N("tr",null,[N("td",yr,G(n.value),1),N("td",null,G(i.value),1)])],64)):ae("",!0),o.mode==="range"&&(s.value||l.value)?(w(),P($,{key:1},[d[1]||(d[1]=N("tr",null,[N("td",{class:"font-bold text-primary"},"Невязка по сигналам:")],-1)),s.value?(w(),P("tr",br,[N("td",Sr,G(u.value),1),N("td",null,G(s.value),1)])):ae("",!0),l.value?(w(),P("tr",_r,[N("td",Ar,G(c.value),1),N("td",null,G(l.value),1)])):ae("",!0)],64)):ae("",!0)])]))}}),Lr=()=>{const a=de(null),e=de(null);return{tooltipRef:a,tooltipData:e,showData:(n,i)=>{e.value=i??null,a.value&&a.value.show(n)},hideData:()=>{a.value&&(a.value.hide(),e.value=null)}}},Dr={class:"flex flex-column mt-4",style:{gap:"1.2rem"}},wr={key:0,class:"col-4 flex flex-column max-w-min w-full"},Ir="grid justify-content-center",xr=Z({__name:"ResidualsTables",props:{mode:{}},setup(a){const e=fe(),t=Lt("selectedBisStateForResidualsTables"),{tooltipRef:r,tooltipData:n,showData:i,hideData:s}=Lr();return(l,u)=>(w(),P($,null,[N("div",Dr,[(w(),P($,null,X([0,2,4],c=>N("div",{key:c,class:_t(Ir),style:{gap:"0.7rem"}},[(w(),P($,null,X([0,1],o=>{var d,p;return w(),P($,{key:o},[A(e).service.available&&A(e).data?(w(),P("article",wr,[V(kt,{modelValue:A(t)[c+o],"onUpdate:modelValue":f=>A(t)[c+o]=f},null,8,["modelValue","onUpdate:modelValue"]),V(vr,{mode:l.mode,data:A(t)[c+o]!=null?(p=A(e).data)==null?void 0:p[(d=A(t)[c+o])==null?void 0:d.bisId]:null,"show-data":A(i),"hide-data":A(s)},null,8,["mode","data","show-data","hide-data"])])):(w(),J(A(Ot),{key:1,width:"30rem",height:"10rem"}))],64)}),64))])),64))]),V(A(na),{ref_key:"tooltipRef",ref:r,dismissable:""},{default:K(()=>[V(kr,{data:A(n),mode:l.mode},null,8,["data","mode"])]),_:1},512),V(At,{timestamp:A(e).service.lastGet},null,8,["timestamp"])],64))}}),qe=he(xr,[["__scopeId","data-v-ffed5f11"]]);function Pr(a,e,t,r,n){var i=a.getArea(),s=i.x,l=i.y,u=i.width,c=i.height,o=t.get(["lineStyle","width"])||2;s-=o/2,l-=o/2,u+=o,c+=o,u=Math.ceil(u),s!==Math.floor(s)&&(s=Math.floor(s),u++);var d=new Re({shape:{x:s,y:l,width:u,height:c}});return d}function Nr(a,e,t){var r=a.getArea(),n=q(r.r0,1),i=q(r.r,1),s=new Te({shape:{cx:q(a.cx,1),cy:q(a.cy,1),r0:n,r:i,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}});return s}function Mr(a,e,t,r,n){if(a){if(a.type==="polar")return Nr(a);if(a.type==="cartesian2d")return Pr(a,e,t)}else return null;return null}function Be(a,e){return a.type===e}var Rr={average:function(a){for(var e=0,t=0,r=0;r<a.length;r++)isNaN(a[r])||(e+=a[r],t++);return t===0?NaN:e/t},sum:function(a){for(var e=0,t=0;t<a.length;t++)e+=a[t]||0;return e},max:function(a){for(var e=-1/0,t=0;t<a.length;t++)a[t]>e&&(e=a[t]);return isFinite(e)?e:NaN},min:function(a){for(var e=1/0,t=0;t<a.length;t++)a[t]<e&&(e=a[t]);return isFinite(e)?e:NaN},minmax:function(a){for(var e=-1/0,t=-1/0,r=0;r<a.length;r++){var n=a[r],i=Math.abs(n);i>e&&(e=i,t=n)}return isFinite(t)?t:NaN},nearest:function(a){return a[0]}},Tr=function(a){return Math.round(a.length/2)};function Cr(a){return{seriesType:a,reset:function(e,t,r){var n=e.getData(),i=e.get("sampling"),s=e.coordinateSystem,l=n.count();if(l>10&&s.type==="cartesian2d"&&i){var u=s.getBaseAxis(),c=s.getOtherAxis(u),o=u.getExtent(),d=r.getDevicePixelRatio(),p=Math.abs(o[1]-o[0])*(d||1),f=Math.round(l/p);if(isFinite(f)&&f>1){i==="lttb"&&e.setData(n.lttbDownSample(n.mapDimension(c.dim),1/f));var h=void 0;ua(i)?h=Rr[i]:ca(i)&&(h=i),h&&e.setData(n.downSample(n.mapDimension(c.dim),1/f,h,Tr))}}}}}var Ne=function(a){B(e,a);function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(t,r){return Dt(null,this,{useEncodeDefaulter:!0})},e.prototype.getMarkerPosition=function(t,r,n){var i=this.coordinateSystem;if(i&&i.clampData){var s=i.clampData(t),l=i.dataToPoint(s);if(n)U(i.getAxes(),function(p,f){if(p.type==="category"&&r!=null){var h=p.getTicksCoords(),m=p.getTickModel().get("alignWithLabel"),g=s[f],_=r[f]==="x1"||r[f]==="y1";if(_&&!m&&(g+=1),h.length<2)return;if(h.length===2){l[f]=p.toGlobalCoord(p.getExtent()[_?1:0]);return}for(var b=void 0,k=void 0,v=1,y=0;y<h.length;y++){var D=h[y].coord,S=y===h.length-1?h[y-1].tickValue+v:h[y].tickValue;if(S===g){k=D;break}else if(S<g)b=D;else if(b!=null&&S>g){k=(D+b)/2;break}y===1&&(v=S-h[0].tickValue)}k==null&&(b?b&&(k=h[h.length-1].coord):k=h[0].coord),l[f]=p.toGlobalCoord(k)}});else{var u=this.getData(),c=u.getLayout("offset"),o=u.getLayout("size"),d=i.getBaseAxis().isHorizontal()?0:1;l[d]+=c+o/2}return l}return[NaN,NaN]},e.type="series.__base_bar__",e.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"},e}(wt);wt.registerClass(Ne);var Vr=function(a){B(e,a);function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(){return Dt(null,this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},e.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):!1},e.prototype.getProgressiveThreshold=function(){var t=this.get("progressiveThreshold"),r=this.get("largeThreshold");return r>t&&(t=r),t},e.prototype.brushSelector=function(t,r,n){return n.rect(r.getItemLayout(t))},e.type="series.bar",e.dependencies=["grid","polar"],e.defaultOption=da(Ne.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:!1}),e}(Ne),Or=function(){function a(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return a}(),Je=function(a){B(e,a);function e(t){var r=a.call(this,t)||this;return r.type="sausage",r}return e.prototype.getDefaultShape=function(){return new Or},e.prototype.buildPath=function(t,r){var n=r.cx,i=r.cy,s=Math.max(r.r0||0,0),l=Math.max(r.r,0),u=(l-s)*.5,c=s+u,o=r.startAngle,d=r.endAngle,p=r.clockwise,f=Math.PI*2,h=p?d-o<f:o-d<f;h||(o=d-(p?f:-f));var m=Math.cos(o),g=Math.sin(o),_=Math.cos(d),b=Math.sin(d);h?(t.moveTo(m*s+n,g*s+i),t.arc(m*c+n,g*c+i,u,-Math.PI+o,o,!p)):t.moveTo(m*l+n,g*l+i),t.arc(n,i,l,o,d,!p),t.arc(_*c+n,b*c+i,u,d-Math.PI*2,d-Math.PI,!p),s!==0&&t.arc(n,i,s,d,o,p)},e}(Ce);function Er(a,e){e=e||{};var t=e.isRoundCap;return function(r,n,i){var s=n.position;if(!s||s instanceof Array)return Ke(r,n,i);var l=a(s),u=n.distance!=null?n.distance:5,c=this.shape,o=c.cx,d=c.cy,p=c.r,f=c.r0,h=(p+f)/2,m=c.startAngle,g=c.endAngle,_=(m+g)/2,b=t?Math.abs(p-f)/2:0,k=Math.cos,v=Math.sin,y=o+p*k(m),D=d+p*v(m),S="left",I="top";switch(l){case"startArc":y=o+(f-u)*k(_),D=d+(f-u)*v(_),S="center",I="top";break;case"insideStartArc":y=o+(f+u)*k(_),D=d+(f+u)*v(_),S="center",I="bottom";break;case"startAngle":y=o+h*k(m)+ne(m,u+b,!1),D=d+h*v(m)+ie(m,u+b,!1),S="right",I="middle";break;case"insideStartAngle":y=o+h*k(m)+ne(m,-u+b,!1),D=d+h*v(m)+ie(m,-u+b,!1),S="left",I="middle";break;case"middle":y=o+h*k(_),D=d+h*v(_),S="center",I="middle";break;case"endArc":y=o+(p+u)*k(_),D=d+(p+u)*v(_),S="center",I="bottom";break;case"insideEndArc":y=o+(p-u)*k(_),D=d+(p-u)*v(_),S="center",I="top";break;case"endAngle":y=o+h*k(g)+ne(g,u+b,!0),D=d+h*v(g)+ie(g,u+b,!0),S="left",I="middle";break;case"insideEndAngle":y=o+h*k(g)+ne(g,-u+b,!0),D=d+h*v(g)+ie(g,-u+b,!0),S="right",I="middle";break;default:return Ke(r,n,i)}return r=r||{},r.x=y,r.y=D,r.align=S,r.verticalAlign=I,r}}function Br(a,e,t,r){if(It(r)){a.setTextConfig({rotation:r});return}else if(E(e)){a.setTextConfig({rotation:0});return}var n=a.shape,i=n.clockwise?n.startAngle:n.endAngle,s=n.clockwise?n.endAngle:n.startAngle,l=(i+s)/2,u,c=t(e);switch(c){case"startArc":case"insideStartArc":case"middle":case"insideEndArc":case"endArc":u=l;break;case"startAngle":case"insideStartAngle":u=i;break;case"endAngle":case"insideEndAngle":u=s;break;default:a.setTextConfig({rotation:0});return}var o=Math.PI*1.5-u;c==="middle"&&o>Math.PI/2&&o<Math.PI*1.5&&(o-=Math.PI),a.setTextConfig({rotation:o})}function ne(a,e,t){return e*Math.sin(a)*(t?-1:1)}function ie(a,e,t){return e*Math.cos(a)*(t?1:-1)}function zr(a,e,t){var r=a.get("borderRadius");if(r==null)return{cornerRadius:0};E(r)||(r=[r,r,r,r]);var n=Math.abs(e.r||0-e.r0||0);return{cornerRadius:W(r,function(i){return pa(i,n)})}}var Se=Math.max,_e=Math.min;function Fr(a,e){var t=a.getArea&&a.getArea();if(Be(a,"cartesian2d")){var r=a.getBaseAxis();if(r.type!=="category"||!r.onBand){var n=e.getLayout("bandWidth");r.isHorizontal()?(t.x-=n,t.width+=n*2):(t.y-=n,t.height+=n*2)}}return t}var Gr=function(a){B(e,a);function e(){var t=a.call(this)||this;return t.type=e.type,t._isFirstFrame=!0,t}return e.prototype.render=function(t,r,n,i){this._model=t,this._removeOnRenderedListener(n),this._updateDrawMode(t);var s=t.get("coordinateSystem");(s==="cartesian2d"||s==="polar")&&(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(t,r,n):this._renderNormal(t,r,n,i))},e.prototype.incrementalPrepareRender=function(t){this._clear(),this._updateDrawMode(t),this._updateLargeClip(t)},e.prototype.incrementalRender=function(t,r){this._progressiveEls=[],this._incrementalRenderLarge(t,r)},e.prototype.eachRendered=function(t){xt(this._progressiveEls||this.group,t)},e.prototype._updateDrawMode=function(t){var r=t.pipelineContext.large;(this._isLargeDraw==null||r!==this._isLargeDraw)&&(this._isLargeDraw=r,this._clear())},e.prototype._renderNormal=function(t,r,n,i){var s=this.group,l=t.getData(),u=this._data,c=t.coordinateSystem,o=c.getBaseAxis(),d;c.type==="cartesian2d"?d=o.isHorizontal():c.type==="polar"&&(d=o.dim==="angle");var p=t.isAnimationEnabled()?t:null,f=$r(t,c);f&&this._enableRealtimeSort(f,l,n);var h=t.get("clip",!0)||f,m=Fr(c,l);s.removeClipPath();var g=t.get("roundCap",!0),_=t.get("showBackground",!0),b=t.getModel("backgroundStyle"),k=b.get("borderRadius")||0,v=[],y=this._backgroundEls,D=i&&i.isInitSort,S=i&&i.type==="changeAxisOrder";function I(L){var M=se[c.type](l,L),x=Hr(c,d,M);return x.useStyle(b.getItemStyle()),c.type==="cartesian2d"?x.setShape("r",k):x.setShape("cornerRadius",k),v[L]=x,x}l.diff(u).add(function(L){var M=l.getItemModel(L),x=se[c.type](l,L,M);if(_&&I(L),!(!l.hasValue(L)||!rt[c.type](x))){var F=!1;h&&(F=Qe[c.type](m,x));var T=et[c.type](t,l,L,x,d,p,o.model,!1,g);f&&(T.forceLabelAnimation=!0),nt(T,l,L,M,x,t,d,c.type==="polar"),D?T.attr({shape:x}):f?tt(f,p,T,x,L,d,!1,!1):Q(T,{shape:x},t,L),l.setItemGraphicEl(L,T),s.add(T),T.ignore=F}}).update(function(L,M){var x=l.getItemModel(L),F=se[c.type](l,L,x);if(_){var T=void 0;y.length===0?T=I(M):(T=y[M],T.useStyle(b.getItemStyle()),c.type==="cartesian2d"?T.setShape("r",k):T.setShape("cornerRadius",k),v[L]=T);var Wt=se[c.type](l,L),Yt=zt(d,Wt,c);j(T,{shape:Yt},p,L)}var C=u.getItemGraphicEl(M);if(!l.hasValue(L)||!rt[c.type](F)){s.remove(C);return}var ve=!1;if(h&&(ve=Qe[c.type](m,F),ve&&s.remove(C)),C?ha(C):C=et[c.type](t,l,L,F,d,p,o.model,!!C,g),f&&(C.forceLabelAnimation=!0),S){var Fe=C.getTextContent();if(Fe){var me=fa(Fe);me.prevValue!=null&&(me.prevValue=me.value)}}else nt(C,l,L,x,F,t,d,c.type==="polar");D?C.attr({shape:F}):f?tt(f,p,C,F,L,d,!0,S):j(C,{shape:F},t,L,null),l.setItemGraphicEl(L,C),C.ignore=ve,s.add(C)}).remove(function(L){var M=u.getItemGraphicEl(L);M&&We(M,t,L)}).execute();var R=this._backgroundGroup||(this._backgroundGroup=new Ve);R.removeAll();for(var z=0;z<v.length;++z)R.add(v[z]);s.add(R),this._backgroundEls=v,this._data=l},e.prototype._renderLarge=function(t,r,n){this._clear(),st(t,this.group),this._updateLargeClip(t)},e.prototype._incrementalRenderLarge=function(t,r){this._removeBackground(),st(r,this.group,this._progressiveEls,!0)},e.prototype._updateLargeClip=function(t){var r=t.get("clip",!0)&&Mr(t.coordinateSystem,!1,t),n=this.group;r?n.setClipPath(r):n.removeClipPath()},e.prototype._enableRealtimeSort=function(t,r,n){var i=this;if(r.count()){var s=t.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(r,t,n),this._isFirstFrame=!1;else{var l=function(u){var c=r.getItemGraphicEl(u),o=c&&c.shape;return o&&Math.abs(s.isHorizontal()?o.height:o.width)||0};this._onRendered=function(){i._updateSortWithinSameData(r,l,s,n)},n.getZr().on("rendered",this._onRendered)}}},e.prototype._dataSort=function(t,r,n){var i=[];return t.each(t.mapDimension(r.dim),function(s,l){var u=n(l);u=u??NaN,i.push({dataIndex:l,mappedValue:u,ordinalNumber:s})}),i.sort(function(s,l){return l.mappedValue-s.mappedValue}),{ordinalNumbers:W(i,function(s){return s.ordinalNumber})}},e.prototype._isOrderChangedWithinSameData=function(t,r,n){for(var i=n.scale,s=t.mapDimension(n.dim),l=Number.MAX_VALUE,u=0,c=i.getOrdinalMeta().categories.length;u<c;++u){var o=t.rawIndexOf(s,i.getRawOrdinalNumber(u)),d=o<0?Number.MIN_VALUE:r(t.indexOfRawIndex(o));if(d>l)return!0;l=d}return!1},e.prototype._isOrderDifferentInView=function(t,r){for(var n=r.scale,i=n.getExtent(),s=Math.max(0,i[0]),l=Math.min(i[1],n.getOrdinalMeta().categories.length-1);s<=l;++s)if(t.ordinalNumbers[s]!==n.getRawOrdinalNumber(s))return!0},e.prototype._updateSortWithinSameData=function(t,r,n,i){if(this._isOrderChangedWithinSameData(t,r,n)){var s=this._dataSort(t,n,r);this._isOrderDifferentInView(s,n)&&(this._removeOnRenderedListener(i),i.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:s}))}},e.prototype._dispatchInitSort=function(t,r,n){var i=r.baseAxis,s=this._dataSort(t,i,function(l){return t.get(t.mapDimension(r.otherAxis.dim),l)});n.dispatchAction({type:"changeAxisOrder",componentType:i.dim+"Axis",isInitSort:!0,axisId:i.index,sortInfo:s})},e.prototype.remove=function(t,r){this._clear(this._model),this._removeOnRenderedListener(r)},e.prototype.dispose=function(t,r){this._removeOnRenderedListener(r)},e.prototype._removeOnRenderedListener=function(t){this._onRendered&&(t.getZr().off("rendered",this._onRendered),this._onRendered=null)},e.prototype._clear=function(t){var r=this.group,n=this._data;t&&t.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl(function(i){We(i,t,ee(i).dataIndex)})):r.removeAll(),this._data=null,this._isFirstFrame=!0},e.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},e.type="bar",e}(va),Qe={cartesian2d:function(a,e){var t=e.width<0?-1:1,r=e.height<0?-1:1;t<0&&(e.x+=e.width,e.width=-e.width),r<0&&(e.y+=e.height,e.height=-e.height);var n=a.x+a.width,i=a.y+a.height,s=Se(e.x,a.x),l=_e(e.x+e.width,n),u=Se(e.y,a.y),c=_e(e.y+e.height,i),o=l<s,d=c<u;return e.x=o&&s>n?l:s,e.y=d&&u>i?c:u,e.width=o?0:l-s,e.height=d?0:c-u,t<0&&(e.x+=e.width,e.width=-e.width),r<0&&(e.y+=e.height,e.height=-e.height),o||d},polar:function(a,e){var t=e.r0<=e.r?1:-1;if(t<0){var r=e.r;e.r=e.r0,e.r0=r}var n=_e(e.r,a.r),i=Se(e.r0,a.r0);e.r=n,e.r0=i;var s=n-i<0;if(t<0){var r=e.r;e.r=e.r0,e.r0=r}return s}},et={cartesian2d:function(a,e,t,r,n,i,s,l,u){var c=new Re({shape:H({},r),z2:1});if(c.__dataIndex=t,c.name="item",i){var o=c.shape,d=n?"height":"width";o[d]=0}return c},polar:function(a,e,t,r,n,i,s,l,u){var c=!n&&u?Je:Te,o=new c({shape:r,z2:1});o.name="item";var d=Bt(n);if(o.calculateTextPosition=Er(d,{isRoundCap:c===Je}),i){var p=o.shape,f=n?"r":"endAngle",h={};p[f]=n?r.r0:r.startAngle,h[f]=r[f],(l?j:Q)(o,{shape:h},i)}return o}};function $r(a,e){var t=a.get("realtimeSort",!0),r=e.getBaseAxis();if(t&&r.type==="category"&&e.type==="cartesian2d")return{baseAxis:r,otherAxis:e.getOtherAxis(r)}}function tt(a,e,t,r,n,i,s,l){var u,c;i?(c={x:r.x,width:r.width},u={y:r.y,height:r.height}):(c={y:r.y,height:r.height},u={x:r.x,width:r.width}),l||(s?j:Q)(t,{shape:u},e,n,null);var o=e?a.baseAxis.model:null;(s?j:Q)(t,{shape:c},o,n)}function at(a,e){for(var t=0;t<e.length;t++)if(!isFinite(a[e[t]]))return!0;return!1}var Kr=["x","y","width","height"],Wr=["cx","cy","r","startAngle","endAngle"],rt={cartesian2d:function(a){return!at(a,Kr)},polar:function(a){return!at(a,Wr)}},se={cartesian2d:function(a,e,t){var r=a.getItemLayout(e),n=t?Ur(t,r):0,i=r.width>0?1:-1,s=r.height>0?1:-1;return{x:r.x+i*n/2,y:r.y+s*n/2,width:r.width-i*n,height:r.height-s*n}},polar:function(a,e,t){var r=a.getItemLayout(e);return{cx:r.cx,cy:r.cy,r0:r.r0,r:r.r,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}}};function Yr(a){return a.startAngle!=null&&a.endAngle!=null&&a.startAngle===a.endAngle}function Bt(a){return function(e){var t=e?"Arc":"Angle";return function(r){switch(r){case"start":case"insideStart":case"end":case"insideEnd":return r+t;default:return r}}}(a)}function nt(a,e,t,r,n,i,s,l){var u=e.getItemVisual(t,"style");if(l){if(!i.get("roundCap")){var o=a.shape,d=zr(r.getModel("itemStyle"),o);H(o,d),a.setShape(o)}}else{var c=r.get(["itemStyle","borderRadius"])||0;a.setShape("r",c)}a.useStyle(u);var p=r.getShallow("cursor");p&&a.attr("cursor",p);var f=l?s?n.r>=n.r0?"endArc":"startArc":n.endAngle>=n.startAngle?"endAngle":"startAngle":s?n.height>=0?"bottom":"top":n.width>=0?"right":"left",h=Oe(r);Pt(a,h,{labelFetcher:i,labelDataIndex:t,defaultText:ma(i.getData(),t),inheritColor:u.fill,defaultOpacity:u.opacity,defaultOutsidePosition:f});var m=a.getTextContent();if(l&&m){var g=r.get(["label","position"]);a.textConfig.inside=g==="middle"?!0:null,Br(a,g==="outside"?f:g,Bt(s),r.get(["label","rotate"]))}ga(m,h,i.getRawValue(t),function(b){return Sa(e,b)});var _=r.getModel(["emphasis"]);Nt(a,_.get("focus"),_.get("blurScope"),_.get("disabled")),ya(a,r),Yr(n)&&(a.style.fill="none",a.style.stroke="none",U(a.states,function(b){b.style&&(b.style.fill=b.style.stroke="none")}))}function Ur(a,e){var t=a.get(["itemStyle","borderColor"]);if(!t||t==="none")return 0;var r=a.get(["itemStyle","borderWidth"])||0,n=isNaN(e.width)?Number.MAX_VALUE:Math.abs(e.width),i=isNaN(e.height)?Number.MAX_VALUE:Math.abs(e.height);return Math.min(r,n,i)}var Xr=function(){function a(){}return a}(),it=function(a){B(e,a);function e(t){var r=a.call(this,t)||this;return r.type="largeBar",r}return e.prototype.getDefaultShape=function(){return new Xr},e.prototype.buildPath=function(t,r){for(var n=r.points,i=this.baseDimIdx,s=1-this.baseDimIdx,l=[],u=[],c=this.barWidth,o=0;o<n.length;o+=3)u[i]=c,u[s]=n[o+2],l[i]=n[o+i],l[s]=n[o+s],t.rect(l[0],l[1],u[0],u[1])},e}(Ce);function st(a,e,t,r){var n=a.getData(),i=n.getLayout("valueAxisHorizontal")?1:0,s=n.getLayout("largeDataIndices"),l=n.getLayout("size"),u=a.getModel("backgroundStyle"),c=n.getLayout("largeBackgroundPoints");if(c){var o=new it({shape:{points:c},incremental:!!r,silent:!0,z2:0});o.baseDimIdx=i,o.largeDataIndices=s,o.barWidth=l,o.useStyle(u.getItemStyle()),e.add(o),t&&t.push(o)}var d=new it({shape:{points:n.getLayout("largePoints")},incremental:!!r,ignoreCoarsePointer:!0,z2:1});d.baseDimIdx=i,d.largeDataIndices=s,d.barWidth=l,e.add(d),d.useStyle(n.getVisual("style")),ee(d).seriesIndex=a.seriesIndex,a.get("silent")||(d.on("mousedown",ot),d.on("mousemove",ot)),t&&t.push(d)}var ot=ba(function(a){var e=this,t=jr(e,a.offsetX,a.offsetY);ee(e).dataIndex=t>=0?t:null},30,!1);function jr(a,e,t){for(var r=a.baseDimIdx,n=1-r,i=a.shape.points,s=a.largeDataIndices,l=[],u=[],c=a.barWidth,o=0,d=i.length/3;o<d;o++){var p=o*3;if(u[r]=c,u[n]=i[p+2],l[r]=i[p+r],l[n]=i[p+n],u[n]<0&&(l[n]+=u[n],u[n]=-u[n]),e>=l[0]&&e<=l[0]+u[0]&&t>=l[1]&&t<=l[1]+u[1])return s[o]}return-1}function zt(a,e,t){if(Be(t,"cartesian2d")){var r=e,n=t.getArea();return{x:a?r.x:n.x,y:a?n.y:r.y,width:a?r.width:n.width,height:a?n.height:r.height}}else{var n=t.getArea(),i=e;return{cx:n.cx,cy:n.cy,r0:a?n.r0:i.r0,r:a?n.r:i.r,startAngle:a?i.startAngle:0,endAngle:a?i.endAngle:Math.PI*2}}}function Hr(a,e,t){var r=a.type==="polar"?Te:Re;return new r({shape:zt(e,t,a),silent:!0,z2:0})}function Zr(a){a.registerChartView(Gr),a.registerSeriesModel(Vr),a.registerLayout(a.PRIORITY.VISUAL.LAYOUT,Y(Aa,"bar")),a.registerLayout(a.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,_a("bar")),a.registerProcessor(a.PRIORITY.PROCESSOR.STATISTIC,Cr("bar")),a.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(e,t){var r=e.componentType||"series";t.eachComponent({mainType:r,query:e},function(n){e.sortInfo&&n.axis.setCategorySortInfo(e.sortInfo)})})}var lt=ka.prototype,Ae=La.prototype,Ft=function(){function a(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return a}();(function(a){B(e,a);function e(){return a!==null&&a.apply(this,arguments)||this}return e})(Ft);function ke(a){return isNaN(+a.cpx1)||isNaN(+a.cpy1)}var qr=function(a){B(e,a);function e(t){var r=a.call(this,t)||this;return r.type="ec-line",r}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Ft},e.prototype.buildPath=function(t,r){ke(r)?lt.buildPath.call(this,t,r):Ae.buildPath.call(this,t,r)},e.prototype.pointAt=function(t){return ke(this.shape)?lt.pointAt.call(this,t):Ae.pointAt.call(this,t)},e.prototype.tangentAt=function(t){var r=this.shape,n=ke(r)?[r.x2-r.x1,r.y2-r.y1]:Ae.tangentAt.call(this,t);return Mt(n,n)},e}(Ce),Le=["fromSymbol","toSymbol"];function ut(a){return"_"+a+"Type"}function ct(a,e,t){var r=e.getItemVisual(t,a);if(!r||r==="none")return r;var n=e.getItemVisual(t,a+"Size"),i=e.getItemVisual(t,a+"Rotate"),s=e.getItemVisual(t,a+"Offset"),l=e.getItemVisual(t,a+"KeepAspect"),u=Rt(n),c=Tt(s||0,u);return r+u+c+(i||"")+(l||"")}function dt(a,e,t){var r=e.getItemVisual(t,a);if(!(!r||r==="none")){var n=e.getItemVisual(t,a+"Size"),i=e.getItemVisual(t,a+"Rotate"),s=e.getItemVisual(t,a+"Offset"),l=e.getItemVisual(t,a+"KeepAspect"),u=Rt(n),c=Tt(s||0,u),o=xa(r,-u[0]/2+c[0],-u[1]/2+c[1],u[0],u[1],null,l);return o.__specifiedRotation=i==null||isNaN(i)?void 0:+i*Math.PI/180||0,o.name=a,o}}function Jr(a){var e=new qr({name:"line",subPixelOptimize:!0});return Me(e.shape,a),e}function Me(a,e){a.x1=e[0][0],a.y1=e[0][1],a.x2=e[1][0],a.y2=e[1][1],a.percent=1;var t=e[2];t?(a.cpx1=t[0],a.cpy1=t[1]):(a.cpx1=NaN,a.cpy1=NaN)}var Qr=function(a){B(e,a);function e(t,r,n){var i=a.call(this)||this;return i._createLine(t,r,n),i}return e.prototype._createLine=function(t,r,n){var i=t.hostModel,s=t.getItemLayout(r),l=Jr(s);l.shape.percent=0,Q(l,{shape:{percent:1}},i,r),this.add(l),U(Le,function(u){var c=dt(u,t,r);this.add(c),this[ut(u)]=ct(u,t,r)},this),this._updateCommonStl(t,r,n)},e.prototype.updateData=function(t,r,n){var i=t.hostModel,s=this.childOfName("line"),l=t.getItemLayout(r),u={shape:{}};Me(u.shape,l),j(s,u,i,r),U(Le,function(c){var o=ct(c,t,r),d=ut(c);if(this[d]!==o){this.remove(this.childOfName(c));var p=dt(c,t,r);this.add(p)}this[d]=o},this),this._updateCommonStl(t,r,n)},e.prototype.getLinePath=function(){return this.childAt(0)},e.prototype._updateCommonStl=function(t,r,n){var i=t.hostModel,s=this.childOfName("line"),l=n&&n.emphasisLineStyle,u=n&&n.blurLineStyle,c=n&&n.selectLineStyle,o=n&&n.labelStatesModels,d=n&&n.emphasisDisabled,p=n&&n.focus,f=n&&n.blurScope;if(!n||t.hasItemOption){var h=t.getItemModel(r),m=h.getModel("emphasis");l=m.getModel("lineStyle").getLineStyle(),u=h.getModel(["blur","lineStyle"]).getLineStyle(),c=h.getModel(["select","lineStyle"]).getLineStyle(),d=m.get("disabled"),p=m.get("focus"),f=m.get("blurScope"),o=Oe(h)}var g=t.getItemVisual(r,"style"),_=g.stroke;s.useStyle(g),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=l,s.ensureState("blur").style=u,s.ensureState("select").style=c,U(Le,function(D){var S=this.childOfName(D);if(S){S.setColor(_),S.style.opacity=g.opacity;for(var I=0;I<Ye.length;I++){var R=Ye[I],z=s.getState(R);if(z){var L=z.style||{},M=S.ensureState(R),x=M.style||(M.style={});L.stroke!=null&&(x[S.__isEmptyBrush?"stroke":"fill"]=L.stroke),L.opacity!=null&&(x.opacity=L.opacity)}}S.markRedraw()}},this);var b=i.getRawValue(r);Pt(this,o,{labelDataIndex:r,labelFetcher:{getFormattedLabel:function(D,S){return i.getFormattedLabel(D,S,t.dataType)}},inheritColor:_||"#000",defaultOpacity:g.opacity,defaultText:(b==null?t.getName(r):isFinite(b)?q(b):b)+""});var k=this.getTextContent();if(k){var v=o.normal;k.__align=k.style.align,k.__verticalAlign=k.style.verticalAlign,k.__position=v.get("position")||"middle";var y=v.get("distance");E(y)||(y=[y,y]),k.__labelDistance=y}this.setTextConfig({position:null,local:!0,inside:!1}),Nt(this,p,f,d)},e.prototype.highlight=function(){Da(this)},e.prototype.downplay=function(){wa(this)},e.prototype.updateLayout=function(t,r){this.setLinePoints(t.getItemLayout(r))},e.prototype.setLinePoints=function(t){var r=this.childOfName("line");Me(r.shape,t),r.dirty()},e.prototype.beforeUpdate=function(){var t=this,r=t.childOfName("fromSymbol"),n=t.childOfName("toSymbol"),i=t.getTextContent();if(!r&&!n&&(!i||i.ignore))return;for(var s=1,l=this.parent;l;)l.scaleX&&(s/=l.scaleX),l=l.parent;var u=t.childOfName("line");if(!this.__dirty&&!u.__dirty)return;var c=u.shape.percent,o=u.pointAt(0),d=u.pointAt(c),p=Ia([],d,o);Mt(p,p);function f(z,L){var M=z.__specifiedRotation;if(M==null){var x=u.tangentAt(L);z.attr("rotation",(L===1?-1:1)*Math.PI/2-Math.atan2(x[1],x[0]))}else z.attr("rotation",M)}if(r&&(r.setPosition(o),f(r,0),r.scaleX=r.scaleY=s*c,r.markRedraw()),n&&(n.setPosition(d),f(n,1),n.scaleX=n.scaleY=s*c,n.markRedraw()),i&&!i.ignore){i.x=i.y=0,i.originX=i.originY=0;var h=void 0,m=void 0,g=i.__labelDistance,_=g[0]*s,b=g[1]*s,k=c/2,v=u.tangentAt(k),y=[v[1],-v[0]],D=u.pointAt(k);y[1]>0&&(y[0]=-y[0],y[1]=-y[1]);var S=v[0]<0?-1:1;if(i.__position!=="start"&&i.__position!=="end"){var I=-Math.atan2(v[1],v[0]);d[0]<o[0]&&(I=Math.PI+I),i.rotation=I}var R=void 0;switch(i.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":R=-b,m="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":R=b,m="top";break;default:R=0,m="middle"}switch(i.__position){case"end":i.x=p[0]*_+d[0],i.y=p[1]*b+d[1],h=p[0]>.8?"left":p[0]<-.8?"right":"center",m=p[1]>.8?"top":p[1]<-.8?"bottom":"middle";break;case"start":i.x=-p[0]*_+o[0],i.y=-p[1]*b+o[1],h=p[0]>.8?"right":p[0]<-.8?"left":"center",m=p[1]>.8?"bottom":p[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":i.x=_*S+o[0],i.y=o[1]+R,h=v[0]<0?"right":"left",i.originX=-_*S,i.originY=-R;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":i.x=D[0],i.y=D[1]+R,h="center",i.originY=-R;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":i.x=-_*S+d[0],i.y=d[1]+R,h=v[0]>=0?"right":"left",i.originX=_*S,i.originY=-R;break}i.scaleX=i.scaleY=s,i.setStyle({verticalAlign:i.__verticalAlign||m,align:i.__align||h})}},e}(Ve),en=function(){function a(e){this.group=new Ve,this._LineCtor=e||Qr}return a.prototype.updateData=function(e){var t=this;this._progressiveEls=null;var r=this,n=r.group,i=r._lineData;r._lineData=e,i||n.removeAll();var s=pt(e);e.diff(i).add(function(l){t._doAdd(e,l,s)}).update(function(l,u){t._doUpdate(i,e,u,l,s)}).remove(function(l){n.remove(i.getItemGraphicEl(l))}).execute()},a.prototype.updateLayout=function(){var e=this._lineData;e&&e.eachItemGraphicEl(function(t,r){t.updateLayout(e,r)},this)},a.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=pt(e),this._lineData=null,this.group.removeAll()},a.prototype.incrementalUpdate=function(e,t){this._progressiveEls=[];function r(l){!l.isGroup&&!tn(l)&&(l.incremental=!0,l.ensureState("emphasis").hoverLayer=!0)}for(var n=e.start;n<e.end;n++){var i=t.getItemLayout(n);if(De(i)){var s=new this._LineCtor(t,n,this._seriesScope);s.traverse(r),this.group.add(s),t.setItemGraphicEl(n,s),this._progressiveEls.push(s)}}},a.prototype.remove=function(){this.group.removeAll()},a.prototype.eachRendered=function(e){xt(this._progressiveEls||this.group,e)},a.prototype._doAdd=function(e,t,r){var n=e.getItemLayout(t);if(De(n)){var i=new this._LineCtor(e,t,r);e.setItemGraphicEl(t,i),this.group.add(i)}},a.prototype._doUpdate=function(e,t,r,n,i){var s=e.getItemGraphicEl(r);if(!De(t.getItemLayout(n))){this.group.remove(s);return}s?s.updateData(t,n,i):s=new this._LineCtor(t,n,i),t.setItemGraphicEl(n,s),this.group.add(s)},a}();function tn(a){return a.animators&&a.animators.length>0}function pt(a){var e=a.hostModel,t=e.getModel("emphasis");return{lineStyle:e.getModel("lineStyle").getLineStyle(),emphasisLineStyle:t.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:e.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:e.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:t.get("disabled"),blurScope:t.get("blurScope"),focus:t.get("focus"),labelStatesModels:Oe(e)}}function ht(a){return isNaN(a[0])||isNaN(a[1])}function De(a){return a&&!ht(a[0])&&!ht(a[1])}function an(a,e){if(!a)return!1;for(var t=E(a)?a:[a],r=0;r<t.length;r++)if(t[r]&&t[r][e])return!0;return!1}function oe(a){Ra(a,"label",["show"])}var le=Ee(),te=function(a){B(e,a);function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t.createdBySelf=!1,t}return e.prototype.init=function(t,r,n){this.mergeDefaultAndTheme(t,n),this._mergeOption(t,n,!1,!0)},e.prototype.isAnimationEnabled=function(){if(Pa.node)return!1;var t=this.__hostSeries;return this.getShallow("animation")&&t&&t.isAnimationEnabled()},e.prototype.mergeOption=function(t,r){this._mergeOption(t,r,!1,!1)},e.prototype._mergeOption=function(t,r,n,i){var s=this.mainType;n||r.eachSeries(function(l){var u=l.get(this.mainType,!0),c=le(l)[s];if(!u||!u.data){le(l)[s]=null;return}c?c._mergeOption(u,r,!0):(i&&oe(u),U(u.data,function(o){o instanceof Array?(oe(o[0]),oe(o[1])):oe(o)}),c=this.createMarkerModelFromSeries(u,this,r),H(c,{mainType:this.mainType,seriesIndex:l.seriesIndex,name:l.name,createdBySelf:!0}),c.__hostSeries=l),le(l)[s]=c},this)},e.prototype.formatTooltip=function(t,r,n){var i=this.getData(),s=this.getRawValue(t),l=i.getName(t);return Ue("section",{header:this.name,blocks:[Ue("nameValue",{name:l,value:s,noName:!l,noValue:s==null})]})},e.prototype.getData=function(){return this._data},e.prototype.setData=function(t){this._data=t},e.prototype.getDataParams=function(t,r){var n=Ct.prototype.getDataParams.call(this,t,r),i=this.__hostSeries;return i&&(n.seriesId=i.id,n.seriesName=i.name,n.seriesType=i.subType),n},e.getMarkerModelFromSeries=function(t,r){return le(t)[r]},e.type="marker",e.dependencies=["series","grid","polar","geo"],e}(Na);Ma(te,Ct.prototype);function rn(a){return!(isNaN(parseFloat(a.x))&&isNaN(parseFloat(a.y)))}function nn(a){return!isNaN(parseFloat(a.x))&&!isNaN(parseFloat(a.y))}function ue(a,e,t,r,n,i){var s=[],l=Ta(e,r),u=l?e.getCalculationInfo("stackResultDimension"):r,c=ze(e,u,a),o=e.indicesOfNearest(u,c)[0];s[n]=e.get(t,o),s[i]=e.get(u,o);var d=e.get(r,o),p=Ca(e.get(r,o));return p=Math.min(p,20),p>=0&&(s[i]=+s[i].toFixed(p)),[s,d]}var we={min:Y(ue,"min"),max:Y(ue,"max"),average:Y(ue,"average"),median:Y(ue,"median")};function ft(a,e){if(e){var t=a.getData(),r=a.coordinateSystem,n=r&&r.dimensions;if(!nn(e)&&!E(e.coord)&&E(n)){var i=Gt(e,t,r,a);if(e=Vt(e),e.type&&we[e.type]&&i.baseAxis&&i.valueAxis){var s=Xe(n,i.baseAxis.dim),l=Xe(n,i.valueAxis.dim),u=we[e.type](t,i.baseDataDim,i.valueDataDim,s,l);e.coord=u[0],e.value=u[1]}else e.coord=[e.xAxis!=null?e.xAxis:e.radiusAxis,e.yAxis!=null?e.yAxis:e.angleAxis]}if(e.coord==null||!E(n))e.coord=[];else for(var c=e.coord,o=0;o<2;o++)we[c[o]]&&(c[o]=ze(t,t.mapDimension(n[o]),c[o]));return e}}function Gt(a,e,t,r){var n={};return a.valueIndex!=null||a.valueDim!=null?(n.valueDataDim=a.valueIndex!=null?e.getDimension(a.valueIndex):a.valueDim,n.valueAxis=t.getAxis(sn(r,n.valueDataDim)),n.baseAxis=t.getOtherAxis(n.valueAxis),n.baseDataDim=e.mapDimension(n.baseAxis.dim)):(n.baseAxis=r.getBaseAxis(),n.valueAxis=t.getOtherAxis(n.baseAxis),n.baseDataDim=e.mapDimension(n.baseAxis.dim),n.valueDataDim=e.mapDimension(n.valueAxis.dim)),n}function sn(a,e){var t=a.getData().getDimensionInfo(e);return t&&t.coordDim}function vt(a,e){return a&&a.containData&&e.coord&&!rn(e)?a.containData(e.coord):!0}function on(a,e){return a?function(t,r,n,i){var s=i<2?t.coord&&t.coord[i]:t.value;return je(s,e[i])}:function(t,r,n,i){return je(t.value,e[i])}}function ze(a,e,t){if(t==="average"){var r=0,n=0;return a.each(e,function(i,s){isNaN(i)||(r+=i,n++)}),r/n}else return t==="median"?a.getMedian(e):a.getDataExtent(e)[t==="max"?1:0]}var Ie=Ee(),ln=function(a){B(e,a);function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(){this.markerGroupMap=Va()},e.prototype.render=function(t,r,n){var i=this,s=this.markerGroupMap;s.each(function(l){Ie(l).keep=!1}),r.eachSeries(function(l){var u=te.getMarkerModelFromSeries(l,i.type);u&&i.renderSeries(l,u,r,n)}),s.each(function(l){!Ie(l).keep&&i.group.remove(l.group)})},e.prototype.markKeep=function(t){Ie(t).keep=!0},e.prototype.toggleBlurSeries=function(t,r){var n=this;U(t,function(i){var s=te.getMarkerModelFromSeries(i,n.type);if(s){var l=s.getData();l.eachItemGraphicEl(function(u){u&&(r?Oa(u):Ea(u))})}})},e.type="marker",e}(Ba),un=function(a){B(e,a);function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.createMarkerModelFromSeries=function(t,r,n){return new e(t,r,n)},e.type="markLine",e.defaultOption={z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},e}(te),ce=Ee(),cn=function(a,e,t,r){var n=a.getData(),i;if(E(r))i=r;else{var s=r.type;if(s==="min"||s==="max"||s==="average"||s==="median"||r.xAxis!=null||r.yAxis!=null){var l=void 0,u=void 0;if(r.yAxis!=null||r.xAxis!=null)l=e.getAxis(r.yAxis!=null?"y":"x"),u=Ga(r.yAxis,r.xAxis);else{var c=Gt(r,n,e,a);l=c.valueAxis;var o=$a(n,c.valueDataDim);u=ze(n,o,s)}var d=l.dim==="x"?0:1,p=1-d,f=Vt(r),h={coord:[]};f.type=null,f.coord=[],f.coord[p]=-1/0,h.coord[p]=1/0;var m=t.get("precision");m>=0&&It(u)&&(u=+u.toFixed(Math.min(m,20))),f.coord[d]=h.coord[d]=u,i=[f,h,{type:s,valueIndex:r.valueIndex,value:u}]}else i=[]}var g=[ft(a,i[0]),ft(a,i[1]),H({},i[2])];return g[2].type=g[2].type||null,He(g[2],g[0]),He(g[2],g[1]),g};function pe(a){return!isNaN(a)&&!isFinite(a)}function mt(a,e,t,r){var n=1-a,i=r.dimensions[a];return pe(e[n])&&pe(t[n])&&e[a]===t[a]&&r.getAxis(i).containData(e[a])}function dn(a,e){if(a.type==="cartesian2d"){var t=e[0].coord,r=e[1].coord;if(t&&r&&(mt(1,t,r,a)||mt(0,t,r,a)))return!0}return vt(a,e[0])&&vt(a,e[1])}function xe(a,e,t,r,n){var i=r.coordinateSystem,s=a.getItemModel(e),l,u=Ze(s.get("x"),n.getWidth()),c=Ze(s.get("y"),n.getHeight());if(!isNaN(u)&&!isNaN(c))l=[u,c];else{if(r.getMarkerPosition)l=r.getMarkerPosition(a.getValues(a.dimensions,e));else{var o=i.dimensions,d=a.get(o[0],e),p=a.get(o[1],e);l=i.dataToPoint([d,p])}if(Be(i,"cartesian2d")){var f=i.getAxis("x"),h=i.getAxis("y"),o=i.dimensions;pe(a.get(o[0],e))?l[0]=f.toGlobalCoord(f.getExtent()[t?0:1]):pe(a.get(o[1],e))&&(l[1]=h.toGlobalCoord(h.getExtent()[t?0:1]))}isNaN(u)||(l[0]=u),isNaN(c)||(l[1]=c)}a.setItemLayout(e,l)}var pn=function(a){B(e,a);function e(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.updateTransform=function(t,r,n){r.eachSeries(function(i){var s=te.getMarkerModelFromSeries(i,"markLine");if(s){var l=s.getData(),u=ce(s).from,c=ce(s).to;u.each(function(o){xe(u,o,!0,i,n),xe(c,o,!1,i,n)}),l.each(function(o){l.setItemLayout(o,[u.getItemLayout(o),c.getItemLayout(o)])}),this.markerGroupMap.get(i.id).updateLayout()}},this)},e.prototype.renderSeries=function(t,r,n,i){var s=t.coordinateSystem,l=t.id,u=t.getData(),c=this.markerGroupMap,o=c.get(l)||c.set(l,new en);this.group.add(o.group);var d=hn(s,t,r),p=d.from,f=d.to,h=d.line;ce(r).from=p,ce(r).to=f,r.setData(h);var m=r.get("symbol"),g=r.get("symbolSize"),_=r.get("symbolRotate"),b=r.get("symbolOffset");E(m)||(m=[m,m]),E(g)||(g=[g,g]),E(_)||(_=[_,_]),E(b)||(b=[b,b]),d.from.each(function(v){k(p,v,!0),k(f,v,!1)}),h.each(function(v){var y=h.getItemModel(v).getModel("lineStyle").getLineStyle();h.setItemLayout(v,[p.getItemLayout(v),f.getItemLayout(v)]),y.stroke==null&&(y.stroke=p.getItemVisual(v,"style").fill),h.setItemVisual(v,{fromSymbolKeepAspect:p.getItemVisual(v,"symbolKeepAspect"),fromSymbolOffset:p.getItemVisual(v,"symbolOffset"),fromSymbolRotate:p.getItemVisual(v,"symbolRotate"),fromSymbolSize:p.getItemVisual(v,"symbolSize"),fromSymbol:p.getItemVisual(v,"symbol"),toSymbolKeepAspect:f.getItemVisual(v,"symbolKeepAspect"),toSymbolOffset:f.getItemVisual(v,"symbolOffset"),toSymbolRotate:f.getItemVisual(v,"symbolRotate"),toSymbolSize:f.getItemVisual(v,"symbolSize"),toSymbol:f.getItemVisual(v,"symbol"),style:y})}),o.updateData(h),d.line.eachItemGraphicEl(function(v){ee(v).dataModel=r,v.traverse(function(y){ee(y).dataModel=r})});function k(v,y,D){var S=v.getItemModel(y);xe(v,y,D,t,i);var I=S.getModel("itemStyle").getItemStyle();I.fill==null&&(I.fill=za(u,"color")),v.setItemVisual(y,{symbolKeepAspect:S.get("symbolKeepAspect"),symbolOffset:re(S.get("symbolOffset",!0),b[D?0:1]),symbolRotate:re(S.get("symbolRotate",!0),_[D?0:1]),symbolSize:re(S.get("symbolSize"),g[D?0:1]),symbol:re(S.get("symbol",!0),m[D?0:1]),style:I})}this.markKeep(o),o.group.silent=r.get("silent")||t.get("silent")},e.type="markLine",e}(ln);function hn(a,e,t){var r;a?r=W(a&&a.dimensions,function(c){var o=e.getData().getDimensionInfo(e.getData().mapDimension(c))||{};return H(H({},o),{name:c,ordinalMeta:null})}):r=[{name:"value",type:"float"}];var n=new ye(r,t),i=new ye(r,t),s=new ye([],t),l=W(t.get("data"),Y(cn,e,a,t));a&&(l=Fa(l,Y(dn,a)));var u=on(!!a,r);return n.initData(W(l,function(c){return c[0]}),null,u),i.initData(W(l,function(c){return c[1]}),null,u),s.initData(W(l,function(c){return c[2]})),s.hasItemOption=!0,{from:n,to:i,line:s}}function fn(a){a.registerComponentModel(un),a.registerComponentView(pn),a.registerPreprocessor(function(e){an(e.series,"markLine")&&(e.markLine=e.markLine||{})})}const $t=()=>bt().sysNumList,vn=10,Kt=gt("config",()=>{const a=yt({url:"/config",startImmediately:!0}),e=O(()=>{var t,r;return((r=(t=a.data)==null?void 0:t.bisControl)==null?void 0:r.residualAverageDifferenceThreshold)??vn});return{config:a.data,residualsThreshold:e}}),mn=()=>{const a=fe(),e=Kt(),t=O(()=>a.data),r=$t(),n=de(Ka());return O(()=>t.value==null?{}:Object.entries(t.value).reduce((s,[l,u])=>{const c=Object.entries(u).map(([d,p])=>{const f=r.map(h=>{var m;return(m=p[h])!=null&&m.delta?Math.abs(p[h].delta):0});return{name:St(d),type:"bar",data:f,itemStyle:{color:n.value[Number(d)]},markLine:{silent:!0,animation:!1,label:{show:!0},data:[{yAxis:e.residualsThreshold}],tooltip:{show:!1},symbol:"circle"}}}),o=Math.max(...c.flatMap(d=>d.data));return s[Number(l)]={series:c,maxValue:o||1},s},{}))},gn=(a,e)=>e!=null?e+20:a*1.1,yn=a=>{const e=Kt();return gn(a,e.residualsThreshold)},bn=Z({__name:"CurrentResidualsPlot",props:{enableLegend:{type:Boolean,default:!1},bis:{}},setup(a){const e=a,t=$t(),r={xAxis:[],series:[],maxValue:1};Wa([Ua,Zr,Xa,ja,Ha,fn]);const n=de({textColor:getComputedStyle(document.documentElement).getPropertyValue("--text-color"),textColorSecondary:getComputedStyle(document.documentElement).getPropertyValue("--text-color-secondary"),surfaceBorder:getComputedStyle(document.documentElement).getPropertyValue("--surface-border")}),i=mn(),s=O(()=>{var u;return((u=e.bis)==null?void 0:u.bisId)!=null&&i.value[e.bis.bisId]||r}),l=O(()=>({transition:["all"],tooltip:{trigger:"item",formatter:Za},grid:{show:!0,left:e.enableLegend==!0?"12%":"15px",right:"20px",top:"15px",bottom:"20px",containLabel:!0},legend:{show:e.enableLegend,itemWidth:15,orient:"vertical",left:"left",textStyle:{color:n.value.textColor},tooltip:{show:!0,formatter:qa}},xAxis:{type:"category",name:"Номер НКА",nameLocation:"middle",nameGap:25,data:t,splitLine:{show:!0,lineStyle:{color:n.value.surfaceBorder,type:"dashed"}},axisLabel:{interval:0,color:n.value.textColorSecondary}},yAxis:{type:"value",name:"Невязка, м",nameLocation:"middle",nameGap:25,max:yn(s.value.maxValue),axisLabel:{color:n.value.textColorSecondary}},series:s.value.series}));return(u,c)=>(w(),J(A(Ya),{option:l.value,autoresize:!0,class:"h-25rem",style:ia({width:e.enableLegend===!0?"47rem":"42rem"})},null,8,["option","style"]))}}),Sn={class:"w-full max-w-full h-full"},_n={class:"grid-3 w-full"},An=Z({__name:"RangeResidualsPlots",setup(a){const e=fe(),t=Lt("selectedBisStateForResidualsPlots");return(r,n)=>(w(),P("div",Sn,[N("div",_n,[(w(),P($,null,X([0,1,2,3,4,5],i=>N("article",{key:i,class:"relative flex flex-column p-0 pb-3"},[V(kt,{modelValue:A(t)[i],"onUpdate:modelValue":s=>A(t)[i]=s,class:"bis-select absolute"},null,8,["modelValue","onUpdate:modelValue"]),V(bn,{"enable-legend":i===0||i===3,bis:A(t)[i]},null,8,["enable-legend","bis"])])),64))]),V(At,{timestamp:A(e).service.lastGet},null,8,["timestamp"])]))}}),kn=he(An,[["__scopeId","data-v-6e440835"]]),Ln=Z({__name:"Residuals",setup(a){const e=fe();e.service.start();const t=Ja("residualsCurrentTab",1);return Qa(3e5),sa(()=>{e.service.stop()}),(r,n)=>A(e).service.available?(w(),J(A(la),{key:0,activeIndex:A(t),"onUpdate:activeIndex":n[0]||(n[0]=i=>oa(t)?t.value=i:null),class:"tabview",lazy:!0},{default:K(()=>[V(A(ge),{header:"Графики (ПД)"},{default:K(()=>[V(kn)]),_:1}),V(A(ge),{header:"Таблицы (ПД)"},{default:K(()=>[V(qe,{mode:"range"})]),_:1}),V(A(ge),{header:"Таблицы (ПС)"},{default:K(()=>[V(qe,{mode:"speed"})]),_:1})]),_:1},8,["activeIndex"])):A(e).error==null?(w(),J(A($e),{key:1,closable:!1,severity:"info"},{default:K(()=>n[1]||(n[1]=[Pe("Нет данных для отображения")])),_:1})):(w(),J(A($e),{key:2,closable:!1,severity:"error"},{default:K(()=>[Pe(G(A(e).error),1)]),_:1}))}}),Mn=he(Ln,[["__scopeId","data-v-c3fe2abd"]]);export{Mn as default};
