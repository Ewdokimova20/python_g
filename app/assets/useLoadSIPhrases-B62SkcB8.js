import{d as C,r as m,o as p,a as g,b as f,u as d,au as h,am as w,g as N,c as E,h as T,f as M,e as _,cV as A,F,aC as k,j as U,t as V,S as B,J as D,G as $,cl as R,ax as y,cZ as j,c_ as P,C as x}from"./index-B9ncFhZ9.js";import{g as b,s as J}from"./setItemToLS-BDlwVMSR.js";const L=[{field:"tb",header:"tb",sortable:!0},{field:"n",header:"N",sortable:!1},{field:"phrNum",header:"Номер фразы",sortable:!0}],O=[{field:"na",header:"Na",sortable:!0},{field:"phrNum",header:"Номер фразы",sortable:!0}],K=[{field:"phrNum",header:"Номер фразы",sortable:!0}],q={169:L,701:O,893:L,895:O,921:K},z=Symbol("form"),Y=C({__name:"PhrasesListTable",props:{data:{},error:{},isLoading:{type:Boolean},selection:{}},emits:["update:selection"],setup(n,{emit:t}){const r=n,l=m({tb:{value:null,matchMode:h.CONTAINS},n:{value:null,matchMode:h.CONTAINS},phrNum:{value:null,matchMode:h.CONTAINS},na:{value:null,matchMode:h.CONTAINS}}),u=w(z),c=t;function S(i){c("update:selection",i)}return(i,s)=>i.error?(p(),g(d(B),{key:1,severity:"error",closable:!1},{default:f(()=>[N(V(r.error),1)]),_:1})):(p(),g(d(U),{key:0,value:r.data,filters:l.value,"onUpdate:filters":s[0]||(s[0]=a=>l.value=a),selection:r.selection,class:"p-datatable-sm min-h-0","responsive-layout":"scroll","scroll-height":"100%","sort-field":"dataKey","sort-order":-1,loading:i.isLoading,"filter-display":"row","global-filter-fields":["tb","n","phrNum"],"selection-mode":"single","virtual-scroller-options":{itemSize:30},"onUpdate:selection":S,"striped-rows":""},{empty:f(()=>s[1]||(s[1]=[N(" Ничего не найдено ")])),default:f(()=>[(p(!0),E(F,null,T(d(q)[d(u)],(a,e)=>(p(),g(d(M),{key:e,field:a.field||void 0,header:a.header||"",sortable:a.sortable||!1,"show-filter-menu":!1},{loading:f(()=>s[2]||(s[2]=[N(" Загрузка... ")])),filter:f(({filterModel:o,filterCallback:v})=>[_(d(A),{modelValue:o.value,"onUpdate:modelValue":I=>o.value=I,type:"text",class:"p-column-filter",placeholder:"Поиск",onInput:I=>v()},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["field","header","sortable"]))),128)),k(i.$slots,"columns")]),_:3},8,["value","filters","selection","loading"]))}}),G=D("si",()=>{const n={siList:[],siPhrasesMap:new Map,siError:"",parseError:"",isSILoading:!1,arePhrasesLoading:!1,lastParsedSI:void 0,parseSIParams:null},t=$(n),r=(s,a)=>{var o;const e=s.response;return e?(e==null?void 0:e.status)===400?a.BAD_REQUEST:(e==null?void 0:e.status)===401?a.NO_CDB_CONNECTION:(e==null?void 0:e.status)===404?a.NOT_FOUND:(e==null?void 0:e.status)===500?a.DEFAULT:e!=null&&e.data?(o=e.data)==null?void 0:o.message:"Возникла ошибка в серверной части СПО КНП":s.request?a.NO_CONNECTION:"Возникла ошибка в серверной части СПО КНП"};async function l(s){t.siList=[],t.siError="",t.isSILoading=!0;try{const a=await y.post("/si",s,{validateStatus:e=>e===200});t.siList=a.data}catch(a){t.siError=r(a,j)}finally{t.isSILoading=!1}}async function u(s){const a=await y.get("/split_si",{params:s,validateStatus:o=>o===200}),e=JSON.stringify(s);t.siPhrasesMap.set(e,a.data),J(e,a.data)}async function c(s){const a=JSON.stringify(s);if(t.arePhrasesLoading=!0,!(!!t.siPhrasesMap.get(a)||!!b(a)||!1))try{await u(s)}catch(o){throw r(o,P)}finally{t.arePhrasesLoading=!1}return t.siPhrasesMap.get(a)||b(a)}async function S(){try{t.parseError="";const s=await y.get("/parsed_si",{params:t.parseSIParams,validateStatus:a=>a===200});t.lastParsedSI=s.data,t.parseSIParams=null}catch(s){t.parseError=r(s,P)}}function i(){window.localStorage.clear(),Object.assign(t,n)}return{...R(t),loadSI:l,loadPhrases:c,clearStore:i,getParsedSI:S}}),Z=n=>{const t=m([]),r=m(!1),l=m(""),u=G();return x(async()=>{r.value=!0,l.value="";try{t.value=await u.loadPhrases(n)}catch(c){l.value=c}finally{r.value=!1}}),{phrases:t,isLoading:r,phraseError:l}};export{z as F,Y as _,G as a,Z as u};
